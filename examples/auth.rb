#!/usr/bin/env ruby

require_relative '../lib/sezame-sdk/client'

cert       = "-----BEGIN CERTIFICATE-----\nMIIEAjCCAuqgAwIBAgIBADANBgkqhkiG9w0BAQsFADCBpTELMAkGA1UEBhMCQVQx\nDzANBgNVBAgMBlZpZW5uYTEPMA0GA1UEBwwGVmllbm5hMSEwHwYDVQQKDBhGaW5Q\naW4gVGVjaG5vbG9naWVzIEdtYkgxFDASBgNVBAsMC0RldmVsb3BtZW50MRIwEAYD\nVQQDDAlTZXphbWUgQ0ExJzAlBgkqhkiG9w0BCQEWGG1ndWVydGxlckBmaW5waW50\nZWNoLmNvbTAeFw0xNTExMjMwODMxNDNaFw0yNTExMjAwODMxNDNaMIGQMQswCQYD\nVQQGEwJBVDEPMA0GA1UECBMGVmllbm5hMQ8wDQYDVQQHEwZWaWVubmExCjAIBgNV\nBAoMAS0xCjAIBgNVBAsMAS0xIDAeBgNVBAMMFzU2NTFmNjc5ZTY1NjcwLjgzNzYw\nNzYyMSUwIwYJKoZIhvcNAQkBDBZyZWdAYnJldHRlcmtsaWViZXIuY29tMIIBIjAN\nBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxSE7PQbr474vjeH4ic1uf9L7F6NN\ndLYPSj7PVL+1LP/hmkJKCSk/ZIPRJSpOHr9LNcnRjdiyl4IMq5fVQ4w2kH8bfvKz\nq+ATfKCJx5X9idkv4PRPLQ7kOM/2c/dObpxMk6EuZC9L5ZIAiUFeeKM1lfH0mK+h\nHMwsiBW9v7yJRQijwRX/kc/NrPky+R0MLbnVgnUtzvHXb0cQvNHQCyod3YxMtmMl\nDfSlDAuebMoZ7zFyfNEQcRJSbscCwqeYnOe7GdRH5052myK1jPT3l+uVQnc/rUx1\nJDOUMpUiNqcVXuXxDxJkBAJXU0HTZjq9GyA/6QgOmDobKo2SSV969nIS0wIDAQAB\no1AwTjAdBgNVHQ4EFgQU717BwVTWbde1U6L6w7/PALDHNE4wHwYDVR0jBBgwFoAU\n9S3iajOJ0eK0BaEvoCJ0sIfadrYwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsF\nAAOCAQEAeLmmNyKbbG1tPkhoD6TWLbMBoHxhwDFSy4M12k8m3KM0wX8Vinc1FNOe\nmGfoGQn7A8LGgDZbzVm9rDIh0hQKdJWYXghDDlhKeus9g4GPdL77C5mKdFj4JeSf\nV/vzpslnA3yTz4/B3KZB1k9HZ7mWTVGXvZ+4Lc0jMW1vVKccOQ7e9V3fkpSOoxWD\nNYBtVs2QY96WvgJ9b2oVPPZErz0/uvacsYa1lgCqh0wAv3DFENpvCohTo0y32pVs\nKsGHU5Iz/tCwUFBG/7BhR13Q3WLgi8yyBJFqbf/gNYjxh1PTTI7+3MyQjU3ntJ5j\nTIb3O6I9sLL7NFvj7cLB3NmHZ7h7KA==\n-----END CERTIFICATE-----\n"
privatekey = "-----BEGIN RSA PRIVATE KEY-----\nMIIEpQIBAAKCAQEAxSE7PQbr474vjeH4ic1uf9L7F6NNdLYPSj7PVL+1LP/hmkJK\nCSk/ZIPRJSpOHr9LNcnRjdiyl4IMq5fVQ4w2kH8bfvKzq+ATfKCJx5X9idkv4PRP\nLQ7kOM/2c/dObpxMk6EuZC9L5ZIAiUFeeKM1lfH0mK+hHMwsiBW9v7yJRQijwRX/\nkc/NrPky+R0MLbnVgnUtzvHXb0cQvNHQCyod3YxMtmMlDfSlDAuebMoZ7zFyfNEQ\ncRJSbscCwqeYnOe7GdRH5052myK1jPT3l+uVQnc/rUx1JDOUMpUiNqcVXuXxDxJk\nBAJXU0HTZjq9GyA/6QgOmDobKo2SSV969nIS0wIDAQABAoIBAQCQLOnijHliK+sj\n3i2ku7chjfFPLISt46nzJ1UEKuIbc1pRNEJpyN0waqhAglx4aHhdcqntEJwt61PQ\n/E9iA960eAJoKqH2BwC5mcCrVKwGce5unMB7t/R7CL67uhiHFZF8N9pyM5VS5iG2\nQTUTDmtWq4u1UF6JbVr0fNI2tXHAJnTOumcg61v+ilCWngkXjkAJg5G4ekiageg2\nayDdDfRgPxDw4dzlYKUSWN2Oh+VBJjGjXM7b6JRMkrwNk6P7H34Xx9GZrdjaS39r\nq+thFjuONANkll9thC/VkMulgLIqwZWL2lBjpza3mQnfn3Wsnf+rwseyXEpJo7xK\nZbhBqCqhAoGBAOWzDbpESjc1gv0i9YPtF4xMW+uZZZDlGO9giDXSQrZm4F0kjSzv\n6DOXgjDzETpAhoKhb01aBNWCqbsYcNL8l60+BmPFyaBvvoRDLydeS3FMOrhyA/Qp\nVRNUs7KSrZdIMLMQowZkDkflxd6NRwUmyg/EViXh62q2TaGDM7Bywut3AoGBANuz\nf2JcZiK62gEbMAPgCAAQSYXpAI1FOfj7R2fjf6IuKqMRIGP3AlM7KkvJznk3hqAT\ntGJ1azAHUL3TRsPWmbWWjfw4mDMqG5GJHoqd+64YuDcHh/mZdAUekPP0Uj0agxQt\nenk3UQsY4rqV3PsUFbCX39f6dROBvaI1cXx/c7KFAoGBAJ/Kgtc8YICtqjUc17zx\n97qy+BMawEwfA8yq07bVUXGAeb5yCf/j2R3i3T/eJ/LlJm3DjiE6aTh60EaGhx5P\nd9id2GYaFtyUP+3Uqv3xG/xyMjtTnaqCAlwTRXsJjNc78hzviumMO18K2i6rC2fr\nBxAW3nM2CcZPkgu0sQWjoDObAoGAJzLefoE34+hsrxfXuElHhCNjytWouIvqbQcA\nVYPcqOYNy2xp2AwhSRJcWItYIH6MsZDydUK37ijP+h5xGM34PNLw4FiEp1RS+ON7\nJIZNemGEtKTOWPVNIwCyIiSsa6SIUJhQqsH43r8A7QOCGvYZbJmcYZ+ZNfLHD+Lz\nLaBb1zUCgYEAik9/leeAUeO16DRGEhGaxpYyKxMtd7LPpbPHv/ZP7KN0NjtWuaSN\nFSsf91llr+uzF4SwNz1L/LqfdDG4qyPQAVLcm46HmUaTJkA6pVfXRjH9g2UbUq+E\nytqnEjKc0VgTNHR6BQoDClJUmIdgPelWqazExuzl5tk9oTaQe0Kldqw=\n-----END RSA PRIVATE KEY-----\n"
timeout = 10 # secs

client = Sezame::Client.new(cert, privatekey)

response = client.authorize('someusername')

if response.is_notfound
  p response.get_message
  exit
end

unless response.is_ok
  p response.get_errors
  p response.get_message
  exit
end

auth_id = response.get_id

timeout.times do |num|
  status = client.status(auth_id)
  if status.is_authorized
    p 'authorized'
    exit
  end

  if status.is_denied
    p 'denied'
    exit
  end

  sleep(1)
end

p 'timeout'
